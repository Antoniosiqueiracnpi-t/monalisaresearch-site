<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Upload de Relat√≥rios</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        /* Login Container */
        .login-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 40px;
            max-width: 400px;
            width: 100%;
            text-align: center;
        }
        
        .login-container h1 {
            color: #333;
            margin-bottom: 30px;
            font-size: 2rem;
        }
        
        .login-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .login-form .form-group {
            margin-bottom: 0;
            text-align: left;
        }
        
        label {
            display: block;
            color: #555;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        input[type="password"], input[type="text"], input[type="date"], textarea, select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
            background: #f8f8f8;
        }
        
        input[type="password"]:focus, select:focus, input[type="text"]:focus, 
        input[type="date"]:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.1);
        }
        
        .btn-login {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .btn-login:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }
        
        .btn-login:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .error-login {
            color: #e74c3c;
            font-size: 14px;
            margin-top: 10px;
            display: none;
        }
        
        .security-info {
            margin-top: 20px;
            padding: 15px;
            background: rgba(74, 144, 226, 0.1);
            border-radius: 10px;
            font-size: 12px;
            color: #666;
        }
        
        /* Upload Container */
        .upload-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 40px;
            max-width: 800px;
            width: 100%;
            display: none;
        }
        
        .logout-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 10px 20px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .logout-btn:hover {
            background: #c0392b;
        }
        
        textarea {
            resize: vertical;
            min-height: 100px;
            font-family: inherit;
        }
        
        .file-upload {
            position: relative;
            display: inline-block;
            width: 100%;
        }
        
        .file-upload input[type="file"] {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        
        .file-upload-label {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            border: 3px dashed rgba(255, 255, 255, 0.5);
        }
        
        .file-upload-label:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
            border-color: white;
        }
        
        .file-upload-text {
            color: white;
            font-size: 18px;
            font-weight: 600;
            text-align: center;
        }
        
        .file-upload-text small {
            display: block;
            font-size: 14px;
            margin-top: 10px;
            opacity: 0.9;
            font-weight: normal;
        }
        
        .file-selected {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            border-color: transparent;
        }
        
        .btn-submit {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 10px;
        }
        
        .btn-submit:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }
        
        .btn-submit:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .success-message, .error-message {
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: center;
            display: none;
            animation: slideIn 0.5s ease;
        }
        
        .success-message {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
        }
        
        .error-message {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .reports-list {
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px solid #e0e0e0;
        }
        
        .reports-list h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }
        
        .report-item {
            background: #f8f8f8;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }
        
        .report-item:hover {
            background: #f0f0f0;
            transform: translateX(5px);
        }
        
        .report-info {
            flex-grow: 1;
        }
        
        .report-type {
            font-weight: 600;
            color: #667eea;
            text-transform: uppercase;
            font-size: 0.9rem;
        }
        
        .report-date {
            color: #888;
            font-size: 0.9rem;
            margin-top: 5px;
        }
        
        .report-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .btn-delete {
            background: #f5576c;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-delete:hover {
            background: #e63946;
            transform: scale(1.05);
        }
        
        .upload-progress {
            display: none;
            margin-top: 20px;
        }
        
        .progress-bar {
            width: 100%;
            height: 30px;
            background: #f0f0f0;
            border-radius: 15px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }
        
        /* Access Control Styles */
        .access-control {
            margin-top: 20px;
            padding: 15px;
            background: #f8f8f8;
            border-radius: 10px;
        }
        
        .access-option {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .access-option input[type="radio"] {
            width: auto;
        }
        
        .access-option label {
            margin-bottom: 0;
            font-weight: normal;
            text-transform: none;
        }
        
        .access-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 5px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            margin-left: 10px;
        }
        
        .badge-public {
            background: #2ecc71;
            color: white;
        }
        
        .badge-private {
            background: #e74c3c;
            color: white;
        }
        
        .code-section {
            margin-top: 40px;
            padding: 20px;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            border-radius: 15px;
        }
        
        .code-section h3 {
            color: #333;
            margin-bottom: 15px;
        }
        
        .current-code {
            padding: 15px;
            background: white;
            border-radius: 10px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .code-display {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
            letter-spacing: 2px;
        }
        
        .btn-generate {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .btn-generate:hover {
            background: #5a6dc7;
        }

        /* Debug section */
        .debug-section {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #007bff;
        }
        
        .debug-info {
            font-family: monospace;
            font-size: 12px;
            color: #495057;
        }
    </style>
</head>
<body>
    <!-- Login Container -->
    <div class="login-container" id="loginContainer">
        <h1>üîí √Årea Administrativa</h1>
        <form class="login-form" id="loginForm">
            <div class="form-group">
                <label for="password">Senha de Acesso</label>
                <input type="password" id="password" placeholder="Digite a senha" required>
            </div>
            <button type="submit" class="btn-login">
                Entrar
            </button>
            <div class="error-login" id="loginError">
                Senha incorreta. Tente novamente.
            </div>
        </form>
        <div class="security-info">
            üîê Acesso restrito. Todas as tentativas s√£o registradas.
        </div>
        
        <!-- Debug Section -->
        <div class="debug-section">
            <h4>Debug Info</h4>
            <div class="debug-info" id="debugInfo">
                Carregando informa√ß√µes de debug...
            </div>
            <button type="button" onclick="testPassword()" style="margin-top: 10px; padding: 5px 10px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer;">
                Testar Senha "admin"
            </button>
        </div>
    </div>

    <!-- Upload Container -->
    <div class="upload-container" id="uploadContainer">
        <button class="logout-btn" onclick="logout()">Sair</button>
        
        <h1>üìä Upload de Relat√≥rios</h1>
        
        <form id="uploadForm">
            <div class="form-group">
                <label for="reportType">Tipo de Relat√≥rio *</label>
                <select id="reportType" required>
                    <option value="">Selecione o tipo...</option>
                    <optgroup label="Carteiras e Estrat√©gias">
                        <option value="brasil">Monalisa Brasil - A√ß√µes B3</option>
                        <option value="global">Monalisa Global - S&P 500</option>
                        <option value="quant">Monalisa Quant - Trading</option>
                        <option value="opcoes">Monalisa Op√ß√µes - Derivativos</option>
                        <option value="longshort">Monalisa Long and Short</option>
                        <option value="vectordi">Monalisa Vector DI - Gest√£o Ativa RF</option>
                    </optgroup>
                    <optgroup label="An√°lise de Mercado">
                        <option value="graficos">Gr√°ficos em A√ß√£o - An√°lise T√©cnica</option>
                        <option value="rendafixa">De Olho na Renda Fixa</option>
                        <option value="insights">Monalisa Insights - An√°lise de Mercado</option>
                    </optgroup>
                </select>
            </div>
            
            <div class="form-group">
                <label for="reportTitle">T√≠tulo do Relat√≥rio *</label>
                <input type="text" id="reportTitle" placeholder="Ex: Relat√≥rio Mensal - Agosto 2025" required>
            </div>
            
            <div class="form-group">
                <label for="reportDate">Data do Relat√≥rio *</label>
                <input type="date" id="reportDate" required>
            </div>
            
            <div class="form-group">
                <label for="reportSummary">Resumo *</label>
                <textarea id="reportSummary" placeholder="Descreva brevemente o conte√∫do do relat√≥rio..." required></textarea>
            </div>
            
            <!-- Controle de Acesso -->
            <div class="access-control">
                <label style="margin-bottom: 15px; display: block;">N√≠vel de Acesso *</label>
                <div class="access-option">
                    <input type="radio" id="accessPublic" name="accessLevel" value="public" checked>
                    <label for="accessPublic">
                        üåç P√∫blico - Todos os usu√°rios podem visualizar
                    </label>
                </div>
                <div class="access-option">
                    <input type="radio" id="accessPrivate" name="accessLevel" value="private">
                    <label for="accessPrivate">
                        üîí Privado - Apenas assinantes com c√≥digo de acesso
                    </label>
                </div>
            </div>
            
            <div class="form-group">
                <label>Arquivo PDF * (M√°ximo: 30MB)</label>
                <div class="file-upload">
                    <input type="file" id="pdfFile" accept=".pdf" required>
                    <label for="pdfFile" class="file-upload-label" id="fileLabel">
                        <div class="file-upload-text">
                            üìÑ Clique ou arraste o PDF aqui
                            <small>Aceita apenas arquivos PDF at√© 30MB</small>
                        </div>
                    </label>
                </div>
            </div>
            
            <div class="upload-progress" id="uploadProgress">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill">0%</div>
                </div>
            </div>
            
            <button type="submit" class="btn-submit" id="submitBtn">
                Publicar Relat√≥rio
            </button>
        </form>
        
        <div class="success-message" id="successMessage">
            ‚úÖ Relat√≥rio publicado com sucesso!
        </div>
        
        <div class="error-message" id="errorMessage">
            ‚ùå Erro ao publicar relat√≥rio. Tente novamente.
        </div>
        
        <!-- Se√ß√£o do C√≥digo de Acesso -->
        <div class="code-section">
            <h3>üîë C√≥digo de Acesso para Assinantes</h3>
            <div class="current-code">
                <div>
                    <small style="color: #666;">C√≥digo Atual:</small>
                    <div class="code-display" id="currentCode">------</div>
                </div>
                <button class="btn-generate" onclick="generateNewCode()">
                    Gerar Novo C√≥digo
                </button>
            </div>
            <small style="color: #666;">
                Compartilhe este c√≥digo apenas com assinantes ativos. 
                O c√≥digo √© v√°lido at√© ser alterado.
            </small>
        </div>
        
        <div class="reports-list">
            <h2>üìö Relat√≥rios Publicados</h2>
            <div id="reportsList">
                <p style="color: #888;">Sistema funcionando em modo offline - conecte com Supabase para ver relat√≥rios</p>
            </div>
        </div>
    </div>

    <script>
        // Sistema de Autentica√ß√£o Corrigido
        const AUTH_CONFIG = {
            // Hash SHA-256 da palavra "admin" 
            passwordHash: '8c6976e5b5410415bde908bd4dee15dfb167a9c873fc4bb8a81f6f2ab448a918',
            sessionTimeout: 30 * 60 * 1000, // 30 minutos
            maxAttempts: 5,
            lockoutTime: 15 * 60 * 1000 // 15 minutos
        };
        
        // Fun√ß√£o para calcular SHA-256
        async function sha256(message) {
            try {
                // Encode como UTF-8
                const msgBuffer = new TextEncoder().encode(message);
                // Hash o buffer
                const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
                // Converter array buffer para hex string
                const hashArray = Array.from(new Uint8Array(hashBuffer));
                const hashHex = hashArray
                    .map(b => b.toString(16).padStart(2, '0'))
                    .join('');
                return hashHex;
            } catch (error) {
                console.error('Erro ao calcular SHA-256:', error);
                throw error;
            }
        }
        
        // Verificar autentica√ß√£o
        function checkAuth() {
            const session = sessionStorage.getItem('adminSession');
            if (!session) return false;
            
            try {
                const data = JSON.parse(session);
                if (Date.now() - data.timestamp > AUTH_CONFIG.sessionTimeout) {
                    sessionStorage.removeItem('adminSession');
                    return false;
                }
                return true;
            } catch {
                sessionStorage.removeItem('adminSession');
                return false;
            }
        }
        
        // Fun√ß√£o de teste da senha
        async function testPassword() {
            try {
                const testPassword = "admin";
                const hash = await sha256(testPassword);
                const isValid = hash === AUTH_CONFIG.passwordHash;
                
                updateDebugInfo(`
                    Teste de Senha "admin":
                    - Senha: "${testPassword}"
                    - Hash calculado: ${hash}
                    - Hash esperado: ${AUTH_CONFIG.passwordHash}
                    - Senhas coincidem: ${isValid ? 'SIM' : 'N√ÉO'}
                    - Crypto.subtle dispon√≠vel: ${!!window.crypto?.subtle}
                `);
                
                if (isValid) {
                    alert('‚úÖ Teste bem-sucedido! A senha "admin" deve funcionar.');
                } else {
                    alert('‚ùå Teste falhou! H√° um problema no sistema de hash.');
                }
            } catch (error) {
                updateDebugInfo(`Erro no teste: ${error.message}`);
                alert('‚ùå Erro no teste: ' + error.message);
            }
        }
        
        // Atualizar informa√ß√µes de debug
        function updateDebugInfo(info) {
            const debugElement = document.getElementById('debugInfo');
            if (debugElement) {
                debugElement.textContent = info;
            }
        }
        
        // Sistema de tentativas de login
        function getLoginAttempts() {
            const attempts = parseInt(localStorage.getItem('loginAttempts') || '0');
            const lastAttempt = parseInt(localStorage.getItem('lastLoginAttempt') || '0');
            
            // Resetar se passou do tempo de lockout
            if (attempts >= AUTH_CONFIG.maxAttempts && 
                Date.now() - lastAttempt > AUTH_CONFIG.lockoutTime) {
                localStorage.removeItem('loginAttempts');
                localStorage.removeItem('lastLoginAttempt');
                return { attempts: 0, lastAttempt: 0 };
            }
            
            return { attempts, lastAttempt };
        }
        
        // Login Handler
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const password = document.getElementById('password').value.trim();
            const errorDiv = document.getElementById('loginError');
            const submitBtn = this.querySelector('.btn-login');
            
            // Verificar tentativas
            const { attempts, lastAttempt } = getLoginAttempts();
            
            if (attempts >= AUTH_CONFIG.maxAttempts) {
                const timeLeft = AUTH_CONFIG.lockoutTime - (Date.now() - lastAttempt);
                if (timeLeft > 0) {
                    const minutesLeft = Math.ceil(timeLeft / 60000);
                    errorDiv.textContent = `Muitas tentativas incorretas. Tente novamente em ${minutesLeft} minutos.`;
                    errorDiv.style.display = 'block';
                    return;
                }
            }
            
            // Desabilitar bot√£o durante o processamento
            submitBtn.disabled = true;
            submitBtn.textContent = 'Verificando...';
            
            try {
                // Calcular hash da senha
                const passwordHash = await sha256(password);
                
                console.log('Login attempt:', {
                    password: password,
                    hash: passwordHash,
                    expected: AUTH_CONFIG.passwordHash,
                    match: passwordHash === AUTH_CONFIG.passwordHash
                });
                
                if (passwordHash === AUTH_CONFIG.passwordHash) {
                    // Login bem-sucedido
                    sessionStorage.setItem('adminSession', JSON.stringify({
                        timestamp: Date.now(),
                        authenticated: true
                    }));
                    
                    // Limpar tentativas
                    localStorage.removeItem('loginAttempts');
                    localStorage.removeItem('lastLoginAttempt');
                    
                    // Mostrar √°rea administrativa
                    document.getElementById('loginContainer').style.display = 'none';
                    document.getElementById('uploadContainer').style.display = 'block';
                    
                    // Inicializar sistema
                    initializeAdmin();
                    
                } else {
                    // Login falhou
                    const newAttempts = attempts + 1;
                    localStorage.setItem('loginAttempts', newAttempts.toString());
                    localStorage.setItem('lastLoginAttempt', Date.now().toString());
                    
                    errorDiv.textContent = `Senha incorreta. Tentativa ${newAttempts} de ${AUTH_CONFIG.maxAttempts}`;
                    errorDiv.style.display = 'block';
                    
                    // Limpar campo
                    document.getElementById('password').value = '';
                }
                
            } catch (error) {
                console.error('Erro no login:', error);
                errorDiv.textContent = 'Erro no sistema de autentica√ß√£o. Tente novamente.';
                errorDiv.style.display = 'block';
            }
            
            // Reabilitar bot√£o
            submitBtn.disabled = false;
            submitBtn.textContent = 'Entrar';
        });
        
        // Logout
        function logout() {
            sessionStorage.removeItem('adminSession');
            localStorage.removeItem('loginAttempts');
            localStorage.removeItem('lastLoginAttempt');
            window.location.reload();
        }
        
        // Inicializar √°rea administrativa
        function initializeAdmin() {
            console.log('Inicializando √°rea administrativa...');
            loadAccessCode();
            
            // Verificar se Supabase est√° dispon√≠vel
            if (typeof window.supabase !== 'undefined') {
                console.log('Supabase detectado - carregando relat√≥rios...');
                loadReportsList();
            } else {
                console.log('Supabase n√£o detectado - modo offline');
                document.getElementById('reportsList').innerHTML = 
                    '<p style="color: #888;">Supabase n√£o conectado. Adicione as configura√ß√µes para funcionalidade completa.</p>';
            }
        }
        
        // Sistema de C√≥digo de Acesso
        function generateAccessCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let code = '';
            for (let i = 0; i < 8; i++) {
                if (i === 4) code += '-';
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return code;
        }
        
        function loadAccessCode() {
            let code = localStorage.getItem('subscriberAccessCode');
            if (!code) {
                code = generateAccessCode();
                localStorage.setItem('subscriberAccessCode', code);
            }
            document.getElementById('currentCode').textContent = code;
        }
        
        function generateNewCode() {
            if (confirm('ATEN√á√ÉO: Gerar novo c√≥digo invalidar√° o c√≥digo atual.\n\nTodos os assinantes precisar√£o usar o novo c√≥digo.\n\nContinuar?')) {
                const newCode = generateAccessCode();
                localStorage.setItem('subscriberAccessCode', newCode);
                localStorage.setItem('codeGeneratedAt', Date.now().toString());
                
                document.getElementById('currentCode').textContent = newCode;
                
                alert('‚úÖ Novo c√≥digo gerado: ' + newCode);
            }
        }
        
        // Placeholder para funcionalidades que dependem do Supabase
        async function loadReportsList() {
            try {
                if (typeof window.supabase === 'undefined') {
                    throw new Error('Supabase n√£o configurado');
                }
                
                // Aqui voc√™ adicionaria a l√≥gica real do Supabase
                document.getElementById('reportsList').innerHTML = 
                    '<p style="color: #888;">Conectado ao Supabase - implementar queries aqui</p>';
                    
            } catch (error) {
                console.error('Erro ao carregar relat√≥rios:', error);
                document.getElementById('reportsList').innerHTML = 
                    '<p style="color: #e74c3c;">Erro ao conectar com banco de dados</p>';
            }
        }
        
        // Manipular arquivo
        document.getElementById('pdfFile').addEventListener('change', function(e) {
            const file = e.target.files[0];
            const label = document.getElementById('fileLabel');
            const text = label.querySelector('.file-upload-text');
            
            if (file) {
                const sizeMB = (file.size / 1024 / 1024).toFixed(2);
                const MAX_SIZE = 30 * 1024 * 1024; // 30MB
                
                if (file.size > MAX_SIZE) {
                    alert(`Arquivo muito grande! M√°ximo: 30MB\nSeu arquivo: ${sizeMB}MB`);
                    this.value = '';
                    label.classList.remove('file-selected');
                    text.innerHTML = 'üìÑ Clique ou arraste o PDF aqui<small>Aceita apenas arquivos PDF at√© 30MB</small>';
                    return;
                }
                
                label.classList.add('file-selected');
                text.innerHTML = `‚úÖ ${file.name}<small>${sizeMB} MB</small>`;
            } else {
                label.classList.remove('file-selected');
                text.innerHTML = 'üìÑ Clique ou arraste o PDF aqui<small>Aceita apenas arquivos PDF at√© 30MB</small>';
            }
        });
        
        // Form submit handler
        document.getElementById('uploadForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!checkAuth()) {
                alert('Sess√£o expirada. Fa√ßa login novamente.');
                logout();
                return;
            }
            
            const submitBtn = document.getElementById('submitBtn');
            const successMsg = document.getElementById('successMessage');
            const errorMsg = document.getElementById('errorMessage');
            
            submitBtn.disabled = true;
            submitBtn.textContent = 'Salvando...';
            errorMsg.style.display = 'none';
            successMsg.style.display = 'none';
            
            try {
                // Simular upload (substitua pela l√≥gica real do Supabase)
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                successMsg.style.display = 'block';
                this.reset();
                document.getElementById('fileLabel').classList.remove('file-selected');
                document.querySelector('.file-upload-text').innerHTML = 
                    'üìÑ Clique ou arraste o PDF aqui<small>Aceita apenas arquivos PDF at√© 30MB</small>';
                
                setTimeout(() => {
                    successMsg.style.display = 'none';
                }, 3000);
                
            } catch (error) {
                console.error('Erro:', error);
                errorMsg.textContent = `Erro: ${error.message}`;
                errorMsg.style.display = 'block';
            }
            
            submitBtn.disabled = false;
            submitBtn.textContent = 'Publicar Relat√≥rio';
        });
        
        // Inicializa√ß√£o quando a p√°gina carrega
        window.addEventListener('load', async () => {
            // Mostrar informa√ß√µes de debug
            updateDebugInfo(`
                Sistema carregado:
                - Crypto.subtle: ${!!window.crypto?.subtle ? 'Dispon√≠vel' : 'INDISPON√çVEL'}
                - Hash esperado: ${AUTH_CONFIG.passwordHash}
                - Sess√£o ativa: ${checkAuth() ? 'SIM' : 'N√ÉO'}
                
                Use a senha "admin" para entrar ou clique em "Testar Senha"
            `);
            
            // Verificar se j√° est√° autenticado
            if (checkAuth()) {
                document.getElementById('loginContainer').style.display = 'none';
                document.getElementById('uploadContainer').style.display = 'block';
                initializeAdmin();
            }
        });
    </script>
</body>
</html>
